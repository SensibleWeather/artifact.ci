# artifact.ci

## What

A wrapper around the `actions/upload-artifact` action which makes it possible to view the uploaded artifact in a browser.

>⚠️Note⚠️ This isn't ready yet! Message [me on X](https://x.com/mmkalmmkal) if you want to try it now.

It's a drop in replacement for the `actions/upload-artifact` action, so you can use it in the same way:

```diff
name: CI
on: [push]
jobs:
  run:
    steps:
      - uses: actions/checkout@v4
      - run: npm install
      - run: npx playwright test --reporter html
-     - uses: actions/upload-artifact@v4
+     - uses: mmkal/artifact.ci/upload@main
        if: always()
        with:
          name: e2e-test-report
          path: playwright-report
```

This will print a link to the artifact in your workflow run output, which you can click to view in your browser:

![playwright report](/reports/playwright.png)

## Why

Lots of CI jobs can build really useful, interactive HTML reports - test runners, code coverage, website outputs, PDFs, images, etc. And vendors out there sometimes get your money by offering a dashboard - a link you can click and see what's going on in your browser. But GitHub Actions doesn't - so when a test run fails, for example, you don't have the option of viewing the report in your browser. The existing option is to use `actions/upload-artifact`, then download it as a zip file, unzip it on your local machine, and then poke around at the files or run a local server. By using this action instead, you can just click the link logged by the action, and look at your artifact in your browser. This _should_ really be a feature built into GitHub, and hopefully one day will be, but [for now it isn't](https://github.com/actions/upload-artifact/issues/14). (Note: it is built into some other CI providers like CircleCI).

## How

Here are some high-level guides for how to get useful HTML outputs from various tools:

### Testing frameworks

- [Vitest](/recipes/testing/vitest)
- [Playwright](/recipes/testing/playwright)
- [Jest](/recipes/testing/jest)
- [Mocha](/recipes/testing/mocha)
- [AVA](/recipes/testing/ava)

### Other languages

- [Python](/recipes/python)
- [Go](/recipes/go)

### More

It's not limited to HTML test reports. You can upload any kind of artifact that you might want to view in a browser.

- [A static website](/recipes/website)
- [PDFs](/recipes/pdf)

...you get the idea. If you can render it statically in a web browser, you can upload it to artifact.ci.

## When

For now, it's limited to whitelisted GitHub organizations. In future, I'll open it up to all users, likely based on GitHub sponsorship. It will also be free for open-source projects that don't have commercial sponsors.

Get in touch on [X](https://x.com/mmkalmmkal) if you would like to use this now. There may be changes to the API, and additional usage limits that are added.

## Whether

If you use this, you are sending your CI artifacts to a third-party service. You should only do this if there is no protected or proprietary information in these artifacts. The reason the service is open source is so you can see nothing is being done with the data. If you want to be extra sure of that, see the self-hosting instructions below.

For convenience of use, a *GitHub token is not required* to upload artifacts for open source projects. However this does meant that in theory it is possible to spoof uploads. There are some protections against this - the upload API will check to make sure that the job id provided is running at the time it receives the request. And, only one request can be made for each repo/run/job/attempt. So, a spoofer would need to time their request to run right when your CI job is running, and have a way to gather all the information they need to make a valid request. So while this makes it very unlikely to happen - and if it did happen, you would notice the failed requests from your real CI job - it is still theoretically possible, so you should not consider the URLs generated by this service as 100% secure, unless you configure your repo to require a GitHub token.

For closed-source projects, a token is required.

## How much

Right now this service itself is "free" but since the storage costs money, I'm limiting access to the service to individuals or organizations that are sponsoring me on https://github.com/sponsors/mmkal.

I'm giving some organizations free access - this is based on how much I use them myself.

## Self-host

The code is open-source, so you can self-host it if you want to (e.g. to run on a private network, or to use it without sponsoring me, or to use a different blob storage provider, or to add extra features etc.). Here's how:

- Clone the repository
- Deploy to Vercel - which will automatically detect how to build and deploy the server. You should also be able to use any other platform that supports Next.js.
- You'll need to set the `ALLOWED_GITHUB_OWNERS` environment variable to a comma-separated list of GitHub organizations that are allowed to upload artifacts.
- Blob storage setup:
   - This project uses `@vercel/blob`, but in theory you may be able to use a service that wraps another blob storage provider like AWS, Azure or Cloudflare's offerings, to make them usable with the `@vercel/blob` SDK.
   - Set the `STORAGE_ORIGIN` environment variable to the URL of the storage service you're using.
   - Set the `BLOB_READ_WRITE_TOKEN` environment variable to a token that has read/write access to the storage service.
- Auth setup:
   - Add an environment variable `AUTH_SECRET` to your server deployment.
   - Create a GitHub OAuth app
   - Set the callback URL to `https://<your-domain>/api/auth/callback/github`
   - Set the `AUTH_GITHUB_ID` and `AUTH_GITHUB_SECRET` environment variables to the values from the GitHub OAuth app.
